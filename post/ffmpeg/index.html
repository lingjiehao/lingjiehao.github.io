<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href="https://fonts.loli.net/css?family=Ubuntu" rel=stylesheet><title>FFmpeg</title><link rel=stylesheet href=/css/stylesheet.css></head><body><section id=page-title><h1><a href=/>Aliens</a></h1></section><section class=blog-post><h1>FFmpeg</h1><div class=blog-post-subheader>December 13, 2023</div><div class=blog-post-content><h2 id=转换视频格式>转换视频格式</h2><ol><li><code>.flv/.mp4</code> 等格式的视频转化为原始的<code>.h264</code>视频</li></ol><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># https://stackoverflow.com/questions/19300350/extracting-h264-raw-video-stream-from-mp4-or-flv-with-ffmpeg-generate-an-invalid
ffmpeg -i test.flv -vcodec copy -an -bsf:v h264_mp4toannexb test.h264
</code></pre></td></tr></table></div></div><p>或者简单一点，</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ffmpeg -i testsrc.mp4 -c:v copy output.h264
</code></pre></td></tr></table></div></div><p>注意，输出的文件名必须以<code>.h264</code>结尾。</p><p>同理，想要获取 <code>.h265</code> 格式的视频，可以使用，</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ffmpeg -i testsrc.mp4 -c:v copy output.h265
</code></pre></td></tr></table></div></div><p>需要注意，原始视频<code>testsrc.mp4</code>必须是h264格式的，才能获取h264内容，不能转化为h265内容。</p><ol start=2><li>将视频转化为<code>.yuv</code>格式</li></ol><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># https://stackoverflow.com/questions/20609760/convert-h264-video-to-raw-yuv-format
ffmpeg -i video.mp4 -c:v rawvideo -pix_fmt yuv420p out.yuv
</code></pre></td></tr></table></div></div><ul><li>输入的视频不一定需要封装为.mp4/.mov等，原始的.h264也可以</li><li><code>-pix_fmt</code>后的参数可以通过 <code>ffmpeg -pix_fmts</code> 查看所有支持的参数</li></ul><p>另外，以下是计算生成的<code>.yuv</code>文件大小的方法：</p><p>a. 使用ffprobe video.mp4查看文件信息
<code>Stream #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 320x240 [SAR 1:1 DAR 4:3], 34 kb/s, 25 fps, 25 tbr, 12800 tbn, 50 tbc (default)</code>
b. 那么文件的大小为：320x240x25x1.5x30
- 320, 240: 图像长宽
- 25: fps
- 1.5: 每个像素占用的字节，（对于4个像素，yuv444格式中，需要4Y+4U+4V=12bytes；而yuv420需要占用4Y+1U+1V=6bytes，平局每个像素1.5bytes）
- 30: 视频时长</p><h2 id=测试视频生成>测试视频生成</h2><ol><li>生成彩条视频</li></ol><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ffmpeg -f lavfi -i testsrc -t 30 -pix_fmt yuv420p testsrc.mp4
</code></pre></td></tr></table></div></div></div></section></body></html>