<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href="https://fonts.loli.net/css?family=Ubuntu" rel=stylesheet><title>Linux下常用软件配置</title><link rel=stylesheet href=/css/stylesheet.css></head><body><section id=page-title><h1><a href=/>Aliens</a></h1></section><section class=blog-post><h1>Linux下常用软件配置</h1><div class=blog-post-subheader>April 3, 2021</div><div class=blog-post-content><h2 id=samba>Samba</h2><h3 id=安装>安装</h3><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo apt install samba
</code></pre></div><h3 id=修改配置文件>修改配置文件</h3><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[share]
    path = /home/xyz/share/
    create mask = 0664
    directory mask = 0775
    writable = yes
    valid users = xyz
</code></pre></div><p>其中:</p><ul><li><code>[share]</code>是你共享出来文件夹的名称</li><li><code>create mask</code> 设置的是当新文件创建时的权限(该配置为<code>664</code>权限)</li><li><code>directory mask</code> 设置的是当新文件夹创建时的权限(该配置为664权限)</li><li><code>valid users</code> 表示只有名单内的用户才有权限访问</li></ul><p>配置一个guest只读的共享:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[latest_qfil]
    path = /mnt/build/artifact/latest
    writable = no
    guest ok = yes
</code></pre></div><h3 id=添加用户>添加用户</h3><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo smbpasswd -a xyz
</code></pre></div><p>用户xyz必须是系统中存在的用户,和当前用户<strong>没有关系</strong>.</p><h3 id=启动服务>启动服务</h3><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo service smbd start
</code></pre></div><h2 id=ftp>FTP</h2><h3 id=安装-1>安装</h3><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo apt  install vsftpd
</code></pre></div><h3 id=配置一个匿名共享>配置一个匿名共享</h3><ol><li>创建共享文件夹</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo mkdir /var/ftp/pub
</code></pre></div><ol start=2><li>修改配置文件</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo vi /etc/vsftpd.conf
---
# 1.如果只需要读权限
anonymous_enable=YES
anon_root=/var/ftp/
---
# 2.如果还需要写权限,在1的基础上继续增加
## anon_mkdir_write_enable=YES: 增加匿名用户新建文件夹的权限
## anon_other_write_enable=YES: 增加匿名用户删除/重命名的权限
write_enable=YES
anon_upload_enable=YES
anon_mkdir_write_enable=YES
anon_other_write_enable=YES
---
# 3.可选配置
## 命令行中匿名用户不再需要输入密码
no_anon_password=YES
## 限制被动模式的端口范围
pasv_min_port=40000
pasv_max_port=50000
## 配置匿名用户创建文件的umask
anon_umask=022
</code></pre></div><p>**注意:**虽然配置了匿名用户可写, 但<code>/var/ftp/</code>本身必须是可写的, 可以配置为<code>777</code>权限</p><ol start=3><li>重启服务</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo systemctl restart vsftpd.service
</code></pre></div><p><a href=https://www.digitalocean.com/community/tutorials/how-to-set-up-vsftpd-for-anonymous-downloads-on-ubuntu-16-04>https://www.digitalocean.com/community/tutorials/how-to-set-up-vsftpd-for-anonymous-downloads-on-ubuntu-16-04</a></p><p><a href=https://gist.github.com/rikka0w0/32678ec92fe210ffaf1c0f73e631c0bc>https://gist.github.com/rikka0w0/32678ec92fe210ffaf1c0f73e631c0bc</a></p><h3 id=配置一个使用用户名密码访问可读写的共享>配置一个使用用户名/密码访问,可读写的共享</h3><ol><li>创建共享文件夹</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo mkdir /var/testftp
</code></pre></div><ol start=2><li>创建用户</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># -d: 指定家目录为/, 至于为什么这么指定, 后面会说到
sudo useradd -d / testftp
# 可选配置, nologin还需要进一步配置,参见后文
# sudo useradd -d / testftp -s /usr/sbin/nologin
sudo passwd testftp
...
</code></pre></div><ol start=3><li>修改配置文件</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo vi /etc/vsftpd.conf
---
write_enable=YES
local_root=/var/testftp

# 使用chroot,禁止访问local_root
chroot_local_user=YES
allow_writeable_chroot=YES

# 使用用户白名单
userlist_enable=YES
userlist_file=/etc/vsftpd.userlist
userlist_deny=NO
---
# 可选配置
local_umask=022
</code></pre></div><ol start=4><li>修改用户白名单</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>echo &#34;testftp&#34; | sudo tee -a /etc/vsftpd.userlist
# 打开白名单后,匿名用户便被禁用,除非在白名单列表里加入&#34;anonymous&#34;
echo &#34;anonymous&#34; | sudo tee -a /etc/vsftpd.userlist
</code></pre></div><ol start=5><li>(可选)配置shell为<code>/usr/sbin/nologin</code></li></ol><p>我不希望<code>testftp</code>能够登录终端, 那么可以配置对应的shell为<code>/usr/sbin/nologin</code></p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo chsh testftp -s /usr/sbin/nologin
</code></pre></div><p>但仅仅这么配置会导致ftp无法登录, 还需要再<code>/etc/shells</code>添加<code>/usr/sbin/nologin</code></p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 添加前最好先检查一下是不是已经存在了
echo /usr/sbin/nologin | sudo tee -a /etc/shells
</code></pre></div><ol start=6><li>重启服务</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo systemctl restart vsftpd.service
</code></pre></div><p>为什么要设置<code>testftp</code>的家目录为<code>/</code> ?</p><ul><li><p>使用<code>useradd</code>创建<code>testftp</code>用户后, <code>/etc/passwd</code>中会有如下记录:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>testftp:x:1001:1001::/home/testftp:/bin/sh
</code></pre></div><p>但<code>/home/testftp</code>这个目录并不存在, 所以使用ftp登录后会提示<code>OOPS: cannot change directory:/home/testftp</code>, 导致无法登录. 因此, 我想到了一个workaround, 即把<code>testftp</code>的家目录设为一个存在的目录<code>/</code>, 或许还有其他更优雅的方法.</p></li></ul><h3 id=其他>其他</h3><p>使用中发现, 使用Chrome访问时, 显示的"修改日期"与本地日期不一致, 后来发现有一个<code>use_localtime</code>的选项默认为<code>YES</code>:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>#                                                                                                           # If enabled, vsftpd will display directory listings with the time                                           # in  your  local  time  zone.  The default is to display GMT. The                                           # times returned by the MDTM FTP command are also affected by this                                           # option.                                                                                                   use_localtime=YES
</code></pre></div><p>不过, 根据注释以及<a href=https://blog.csdn.net/wuxintdrh/article/details/80971651>网上别人的介绍</a>, <code>use_localtime</code>配置为<code>YES</code>才应该是我预期的"修改日期"与本地时间一致的方法, 尝试改为<code>NO</code>之后, &ldquo;修改日期"与本地日期竟然一致了, 很是奇怪.</p><h2 id=grub>Grub</h2><h3 id=记住上次选择的启动项>记住上次选择的启动项</h3><p>1.修改/etc/default/grub</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>GRUB_DEFAULT=saved
GRUB_SAVEDEFAULT=true
</code></pre></div><p>2.更新grub</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># Ubuntu下可使用sudo update-grub
sudo grub-mkconfig -o /boot/grub/grub.cfg
</code></pre></div><h3 id=修改网卡名称enp2s0为eth0>修改网卡名称enp2s0为eth0</h3><p>1.修改/etc/default/grub</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>GRUB_CMDLINE_LINUX=&#34;net.ifnames=0 biosdevname=0&#34;
</code></pre></div><p>2.更新grub</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># Ubuntu下可使用sudo update-grub
sudo grub-mkconfig -o /boot/grub/grub.cfg
</code></pre></div><p><strong>注意</strong></p><ul><li>ubuntu 16.04注意还要修改/etc/network/interfaces中的网卡名称</li><li>ubuntu 18.04注意还要修改netplan中的网卡名称</li></ul></div></section></body></html>